{"version":2,"kind":"Notebook","sha256":"58cf0c868a63c8d8bad602cd7bf1bb99208833bb48a4d8d33ec92b84eae08d56","slug":"notebooks.numpy-eofs","location":"/notebooks/numpy-eofs.ipynb","dependencies":[],"frontmatter":{"title":"EOFs with NumPy","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"id":"Project Pythia Community","name":"Project Pythia Community"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/projectpythia/eofs-cookbook","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/projectpythia/eofs-cookbook/blob/main/notebooks/numpy-eofs.ipynb","exports":[{"format":"ipynb","filename":"numpy-eofs.ipynb","url":"/eofs-cookbook/build/numpy-eofs-d3d3ee6aa6a6e064007d00680685de10.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HZTXnKl3TC"}],"key":"UzO6EAMuQX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xP0zFLiyYw"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"uth776x5wB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In order to gain some familiarity with the method, this notebook will work through the EOF method step by step on some synthetic data. We will also see clearly some of the limitations of the method, including mode mixing ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pmIkPVkmol"},{"type":"citeGroup","kind":"parenthetical","children":[{"type":"cite","kind":"parenthetical","label":"chen_pairwise-rotated_2017","identifier":"chen_pairwise-rotated_2017","children":[{"type":"text","value":"Chen ","key":"oJE2k2ZYJL"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"KP2SGA8A4i"}],"key":"FsTkc2VD97"},{"type":"text","value":", 2017","key":"wIiyCvjOqw"}],"enumerator":"1","key":"ldz5wmqja9"}],"key":"xWuarGd9LQ"},{"type":"text","value":" and the generation of unphysical modes ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HzY7l0Zgzd"},{"type":"citeGroup","kind":"parenthetical","children":[{"type":"cite","kind":"parenthetical","label":"dommenget_cautionary_2002","identifier":"dommenget_cautionary_2002","children":[{"type":"text","value":"Dommenget & Latif, 2002","key":"rBZkCV4Vrv"}],"enumerator":"2","key":"aIiPrcbdY1"}],"key":"GCaBUh4qJf"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HpKpILtyhM"}],"key":"zJAJIDsHtx"}],"key":"K2ZtkDZyy5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"psGJqOIVWz"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"jYxHoRIYch"},{"type":"table","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Concepts","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"goG2gvNEde"}],"key":"bwOe3UnlFL"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Importance","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Mj38Q4pVS5"}],"key":"gcDP0o3dcU"},{"type":"tableCell","header":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notes","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Be0UPgice3"}],"key":"Pl0Tt7o6zm"}],"key":"Hl5ttksK9M"},{"type":"tableRow","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"link","url":"https://foundations.projectpythia.org/core/numpy/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Foundations NumPy section","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"exItjcCFwu"}],"urlSource":"https://foundations.projectpythia.org/core/numpy/","key":"FwRLmCkZ4E"}],"key":"G7CyMXAtxL"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Necessary","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zhpvkOExo9"}],"key":"F5l3r7fTC3"},{"type":"tableCell","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[],"key":"Kd5q4XZHIW"}],"key":"mGJJFxPuSb"},{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"/notebooks/eof-intro","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Intro to EOFs","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OJQdQIYhbC"}],"urlSource":"eof-intro","dataUrl":"/notebooks.eof-intro.json","internal":true,"protocol":"file","key":"rXWSBtn6i8"}],"key":"TTF0aUkcyL"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Helpful","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KARdgQ5csk"}],"key":"GP2chz1OZO"},{"type":"tableCell","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[],"key":"ZDdW58p2r6"}],"key":"URjqMPFvHQ"}],"key":"S9rOncxB6V"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Time to learn","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"kmOijuVgGf"}],"key":"CjAKfWEIbr"},{"type":"text","value":": 20 minutes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"w2ggr91DB0"}],"key":"LKCQnnZ6Yn"}],"key":"fi5r3ZSGNB"}],"key":"jKdbu52ZzZ"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"k0B1ZMIzjG"}],"key":"XObweZJ9Xa"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qUfJmdB76q"}],"identifier":"imports","label":"Imports","html_id":"imports","implicit":true,"key":"ARq9OOfMwa"}],"key":"ZlBJPyS0YZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\nimport matplotlib.pyplot as plt\nfrom matplotlib.colors import CenteredNorm","key":"j8r0UGf3R3"},{"type":"output","id":"JPd4l4DzP_XaEMDHDH_p2","data":[],"key":"DrtEmTGhre"}],"key":"N8icLke05S"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set the domain","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DHo6eaYenY"}],"identifier":"set-the-domain","label":"Set the domain","html_id":"set-the-domain","implicit":true,"key":"nMb4BxdXcj"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Assume a domain with two spatial dimensions, ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YFpP4pe5Sm"},{"type":"inlineMath","value":"x","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"mNJnP6QxrQ"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WLcvmlxyrN"},{"type":"inlineMath","value":"y","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"qWIOCPZUuc"},{"type":"text","value":", and time ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bTu2juIZxc"},{"type":"inlineMath","value":"t","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"DhJPsyCs4I"},{"type":"text","value":". For simplicity, we will start all dimensions at zero and increment by one up to some arbitrary maximum, here ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"kvmKaOS9Ai"},{"type":"inlineMath","value":"x=9","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><mn>9</mn></mrow><annotation encoding=\"application/x-tex\">x=9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">9</span></span></span></span>","key":"vxqaFYPram"},{"type":"text","value":", ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RwfbcwSKAv"},{"type":"inlineMath","value":"y=19","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi><mo>=</mo><mn>19</mn></mrow><annotation encoding=\"application/x-tex\">y=19</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">19</span></span></span></span>","key":"gO5f4pgz7O"},{"type":"text","value":", and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LRhUaxadtF"},{"type":"inlineMath","value":"t=49","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>=</mo><mn>49</mn></mrow><annotation encoding=\"application/x-tex\">t=49</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">49</span></span></span></span>","key":"exmkukttDu"},{"type":"text","value":". Different dimension lengths will help highlight the shape of the data as we work through the EOF analysis. We are using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NNiEtvCjIc"},{"type":"inlineCode","value":"numpy.mgrid","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HIS0OSGxEB"},{"type":"text","value":" to create our 3-dimensional domain.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B5xpEAX72J"}],"key":"UTj79Sk4QX"}],"key":"VJzK4SKWAY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x, y, t = np.mgrid[0:10, 0:20, 0:50]\nnx, ny, nt = x.shape[0], x.shape[1], x.shape[2]","key":"I11GbGmk4Z"},{"type":"output","id":"Beo_BNqplejDIOkQY1iQm","data":[],"key":"yHgfSd4Vjk"}],"key":"JdqjXK54cF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x.shape","key":"BCXrV2MEfs"},{"type":"output","id":"Ere9gZcG5bY2g_dWXAjPb","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"(10, 20, 50)","content_type":"text/plain"}}}],"key":"PuK6n4EWKc"}],"key":"l8ysXziovh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Generate some data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hfnUF39Wak"}],"identifier":"generate-some-data","label":"Generate some data","html_id":"generate-some-data","implicit":true,"key":"oDy4UVx6Xp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s generate some “modes of variability” in the domain. We will combine them and then use an EOF analysis to pull them back apart. First, here is a 2-dimensional Gaussian that oscillates between positive and negative with a period of 25 time steps:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u3JNKdYZxl"}],"key":"UhtNBdUxOP"}],"key":"jpKzIkyj2R"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mode_1 = 4*np.exp(-((x - np.mean(x))**2)/3 - ((y - np.mean(y))**2)/5) * np.cos(2*np.pi*t/25)","key":"v4KHU6F4zg"},{"type":"output","id":"Ed4k6CZU3_xvU57GjUuAx","data":[],"key":"HdeFkuPw0S"}],"key":"c5mzHApQjH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 0], y[:, :, 0], mode_1[:, :, 0], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('Mode 1 at $t=0$')","key":"gfj5lEW5sQ"},{"type":"output","id":"O2mgA-XvffaGglin1hl3T","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"58b122d5374b13bd99f4724a6f49ddd1","path":"/eofs-cookbook/build/58b122d5374b13bd99f4724a6f49ddd1.png"}}}],"key":"fGYzcWiR64"}],"key":"OsXcwW5J5X"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To see how this mode changes over time, we can take the mean over the x-axis (a “zonal” mean), and plot it as a function of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cuoy71bPnW"},{"type":"inlineMath","value":"y","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"ZevCFYIfdm"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Hes4soAoc1"},{"type":"inlineMath","value":"t","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>","key":"liPGXDNz03"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zmapSQm2yN"}],"key":"kYcqKmXEjZ"}],"key":"cRu3Ghywbe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(t[0, :, :], y[0, :, :], mode_1.mean(axis=0), cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$t$')\nplt.title('Mode 1 zonal mean over time')","key":"zXPkqgZOlB"},{"type":"output","id":"Tt-muTkPv_Y8xO94RemD5","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d734f577a4a071ec9faad6e9575cd337","path":"/eofs-cookbook/build/d734f577a4a071ec9faad6e9575cd337.png"}}}],"key":"ITJT5fvipC"}],"key":"ugfRlceRfP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here is a second mode, which is the sum of cosines in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OFx0ApnUb6"},{"type":"inlineMath","value":"x","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"nc7aD4K0tv"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rEiv6twGtZ"},{"type":"inlineMath","value":"y","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"fkzdxwjTS4"},{"type":"text","value":" and oscillates between positive and negative with a period of 15 time steps:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D39mTpGhfA"}],"key":"yyWDC6Kkcj"}],"key":"ERIcyoVm35"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mode_2 = (np.cos(2*np.pi*x/(0.5*nx) + 0.5*nx) + np.cos(2*np.pi*y/(0.5*ny) + 0.5*ny)) * np.sin(2*np.pi*t/15)","key":"tXTVsHxvnI"},{"type":"output","id":"17pmERvQAZV3MDjCLKx7J","data":[],"key":"daSOb62120"}],"key":"kqsjnTOd4h"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 2], y[:, :, 2], mode_2[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('Mode 2 at $t=0$')","key":"mwldp1pK6o"},{"type":"output","id":"5S4avfF2BRb1Gz_G2QEHV","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"309ead0768332719c58e5285dee5291c","path":"/eofs-cookbook/build/309ead0768332719c58e5285dee5291c.png"}}}],"key":"sCzRur3dxQ"}],"key":"yi2hRvNLof"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(t[0, :, :], y[0, :, :], mode_2.mean(axis=0), cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$t$')\nplt.title('Mode 2 zonal mean over time')","key":"go6xghgm3Z"},{"type":"output","id":"rYMGIyrfzpFVdJe5Xc2X3","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b22866b4ce24f384a95736e38a7fbc34","path":"/eofs-cookbook/build/b22866b4ce24f384a95736e38a7fbc34.png"}}}],"key":"m4ZlI27UtQ"}],"key":"eFHl4AEx0R"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, let’s add the modes together to get our full dataset:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"McQpnGoEMq"}],"key":"dqQXwQQWWj"}],"key":"jF5gksOQIE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data = mode_1 + mode_2","key":"IMDmqdapYo"},{"type":"output","id":"bz2OMmmiiPBOn1CtzBBHu","data":[],"key":"MkFphkixPW"}],"key":"tGsgQISn8b"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tcgVOPflqc"},{"type":"inlineMath","value":"t=0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">t=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"CGtuGBfiJF"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xWtNt5z9uN"}],"key":"H6c8bRh28B"}],"key":"i7Ew4jXG8D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 2], y[:, :, 2], data[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('Data at $t=0$')","key":"gZN9BfBemp"},{"type":"output","id":"ypuz6oW1ibfoKvPsenl5w","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"64c2e959b5349fa2410355b4ade6661e","path":"/eofs-cookbook/build/64c2e959b5349fa2410355b4ade6661e.png"}}}],"key":"wMvcvfGrBP"}],"key":"xP2qdJrU7m"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prepare data for analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dRB789PhOI"}],"identifier":"prepare-data-for-analysis","label":"Prepare data for analysis","html_id":"prepare-data-for-analysis","implicit":true,"key":"iY45cHHc2K"}],"key":"doKhG1Zs8u"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can see that the modes of variability have mixed, just like in real geophysical data. The next step is to take the time-mean out of every location. Since we just constructed the data and know its dimensions, we know time is ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SJ4HKHi4cF"},{"type":"inlineCode","value":"axis=2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"viJHrsVDJa"},{"type":"text","value":". We also have to reshape the data before subtracting for the array broadcasting to work properly (we are trying subtracting an array of shape [10, 20] from an array of shape [10, 20, 50], but we need [10, 20] to be the final dimensions; with labeled Xarray data this would be simpler).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xty0JMLH2E"}],"key":"huOWgOdcjn"}],"key":"bDBLAenSeZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data = (data.reshape(50, 10, 20) - data.mean(axis=2)).reshape(10, 20, 50)","key":"AjlIJIa0SA"},{"type":"output","id":"KAo5qzLP7tfbp4lYP_2x-","data":[],"key":"ws3xyzKH5u"}],"key":"j2DVhlEGRn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The data then needs to be in the shape (space, time), so we stack the spatial dimensions ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PbgcxueCYb"},{"type":"inlineMath","value":"x,y","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"SyiTvvw5oo"},{"type":"text","value":" into one dimension ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iaxn0OJIym"},{"type":"inlineMath","value":"s","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"TN2gPpzGoI"},{"type":"text","value":". Knowing the size of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wM628Hs09u"},{"type":"inlineMath","value":"x","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"JZ9lR3qRNf"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UBQ2cnBMMC"},{"type":"inlineMath","value":"y","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"zFnQb9fFv4"},{"type":"text","value":" gives us the size of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gZD4yEYRAl"},{"type":"inlineMath","value":"s","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"OT3jKB70oI"},{"type":"text","value":": ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FC48BI05om"},{"type":"inlineMath","value":"10\\times20=200","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mo>×</mo><mn>20</mn><mo>=</mo><mn>200</mn></mrow><annotation encoding=\"application/x-tex\">10\\times20=200</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">10</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">20</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">200</span></span></span></span>","key":"K1FBL7K1T6"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cN38hHOjp3"}],"key":"Ln7K9914eq"}],"key":"pJgzypY3RR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_2d = data.reshape(200, 50)","key":"OqWI4Z0UnY"},{"type":"output","id":"dtvDJJhsbxbKuNL09J0S2","data":[],"key":"xurUATtiWc"}],"key":"SqVBYGuaC9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Do the analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zG3b1gVLod"}],"identifier":"do-the-analysis","label":"Do the analysis","html_id":"do-the-analysis","implicit":true,"key":"dznsfTiITj"}],"key":"TzjPdhYIYg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First, compute the covariance matrix ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DimQHOYINw"},{"type":"inlineMath","value":"R","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>","key":"Dvvpubwvn7"},{"type":"text","value":" of the 2-dimensional data:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f2CDOKHIrg"}],"key":"FELZDGFzlv"}],"key":"jknoGASzxW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"R = np.cov(data_2d)","key":"Y4ogijYg4G"},{"type":"output","id":"G4eUq68q0gHzuhfjfUsid","data":[],"key":"XRYd5yLU0E"}],"key":"ZC9wtrkzds"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"R.shape","key":"eT6OMYfaRy"},{"type":"output","id":"FIpg4wi7_wTQToBROjojB","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"(200, 200)","content_type":"text/plain"}}}],"key":"E355xrczUE"}],"key":"qZ8JuCspjZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"b4vsZeB7dm"},{"type":"inlineCode","value":"numpy.linalg.eig()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J7KoLwwrSu"},{"type":"text","value":" to find the eigenvalues ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a7imEohLCj"},{"type":"inlineCode","value":"eigval","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yyf1UHHOqo"},{"type":"text","value":" and eigenvectors ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EQbmTb313y"},{"type":"inlineCode","value":"eigvec","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jjs0Aaiv1f"},{"type":"text","value":" of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cj07IFYSjG"},{"type":"inlineMath","value":"R","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>","key":"kZB8Y4qesp"},{"type":"text","value":". The eigenvectors will give us the EOFs and PCs, while the eigenvalues tell us about the variance explained by the corresponding eigenvectors.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lA1muBbnkL"}],"key":"MI7s9dbZPo"}],"key":"frZBZfKdTR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"(eigval, eigvec) = np.linalg.eig(R)","key":"oOs8KcISWU"},{"type":"output","id":"-_EvFsTFCiUzIYUFR4U59","data":[],"key":"xRyPe130z3"}],"key":"c0wXazQNoI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The eigenpairs are by default not sorted. We want to sort by the eigenvalues, since they tell us how important the eigenvectors are. Here, we first create an index ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lV9t5iKyXt"},{"type":"inlineCode","value":"i","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y38jlSBWvx"},{"type":"text","value":" that can sort an array by the eigenvalues ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tVZ5pbNxF0"},{"type":"inlineCode","value":"eigval","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VzryQcv8wc"},{"type":"text","value":". Then we sort both ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SvcQ0UvGxp"},{"type":"inlineCode","value":"eigval","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZBRdD8227e"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yyovNziFjV"},{"type":"inlineCode","value":"eigvec","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vt5yuTfcVJ"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PNtuA45yY9"}],"key":"U0vIsajGNy"}],"key":"r31L9pIN4l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"i = np.argsort(-eigval)\neigval = -np.sort(-eigval)\neigvec = eigvec[:,i]","key":"PIp9E3kPSE"},{"type":"output","id":"cwSchSn0v6gqQKiu_ep8-","data":[],"key":"N5acdHeLh0"}],"key":"XcEajhkg2n"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The eigendecomposition resulted in 200 eigenpairs, which is the size of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pTqBZ5n0zD"},{"type":"inlineMath","value":"s","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"AT4vc2nfOC"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n0teIHeQjH"}],"key":"P9LaWYrP4l"}],"key":"Wg9HVs03vF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"eigval.shape, eigvec.shape","key":"UKI31mtopK"},{"type":"output","id":"Bo_kDTzNRau3znf2ryaN1","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"((200,), (200, 200))","content_type":"text/plain"}}}],"key":"nvUQRMN1wo"}],"key":"u7HoUszSvS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Not all of these modes will be important. There are more objective ways to find out how many we should keep, but for now, we will just look at the eigenvalues and look for any clear separation or “drop-off”:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SN0nx9RuH9"}],"key":"MeBg2wCSoB"}],"key":"tgpfKq6InO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.bar(range(10), np.real(eigval[0:10]))","key":"zGy2HC7Gpa"},{"type":"output","id":"M26dpxXB84LTjKAkRp05Z","data":[{"output_type":"execute_result","execution_count":19,"metadata":{},"data":{"text/plain":{"content":"<BarContainer object of 10 artists>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"a79efe0d97929af29909f15c74daf9d6","path":"/eofs-cookbook/build/a79efe0d97929af29909f15c74daf9d6.png"}}}],"key":"VSH11tIpQY"}],"key":"leCxndqwiZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There is a pretty clear drop-off after the second eigenvalue, but let’s keep the first four to see the difference. And before truncating, we will sum over the eigenvalues for the next step.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yyJ0hj0BYB"}],"key":"OANNwO5lZS"}],"key":"lVrTFgVens"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"eigval_sum = np.real(np.sum(eigval))\n\nr = 4\neigval = eigval[:r]\neigvec = eigvec[:, :r]","key":"o3UZ7GL9hD"},{"type":"output","id":"BJdsQT1tLyyuy3qgIoK7u","data":[],"key":"MP18ZRQLyN"}],"key":"pBrHQctJK9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To transform the eigenvalues into ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kkMm6qyQhl"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"explained variance","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dztspzUlv4"}],"key":"OL8NcQ0zIj"},{"type":"text","value":", we need to divide by the sum of all eigenvalues and optionally multiply by 100 to get percentages:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kKgAVB8T92"}],"key":"OAYHvpNTut"}],"key":"bED90MClhB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pvar = np.real(eigval/eigval_sum*100)\npvar","key":"OrtDGNavyw"},{"type":"output","id":"mJzxbQtPDPG-XGTrCP3lg","data":[{"output_type":"execute_result","execution_count":21,"metadata":{},"data":{"text/plain":{"content":"array([6.75819377e+01, 3.21033246e+01, 2.54528647e-01, 6.02090872e-02])","content_type":"text/plain"}}}],"key":"y4rhJJQR9P"}],"key":"gMR0N2wztF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Note that we could have also divided by the trace of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Bub6gHb9sS"},{"type":"inlineMath","value":"R","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span>","key":"nJxzb5PY8K"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oEKoiuciT7"}],"key":"U1ppbxMzfq"}],"key":"Qh8Gt14UTQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"np.real(eigval/np.trace(R)*100)","key":"YEzxavJW0m"},{"type":"output","id":"14Ka0PHCALNnNKC8x6qPa","data":[{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"array([6.75819377e+01, 3.21033246e+01, 2.54528647e-01, 6.02090872e-02])","content_type":"text/plain"}}}],"key":"L53D7JlT7N"}],"key":"Lhbo1Yz602"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To get the PCs, we multiply the 2-dimensional data by the eigenvectors. Looking at the shape of the arrays can help us figure out if we need to transpose (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VcqcTSeJ6Z"},{"type":"inlineCode","value":".T","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hL4IYXF5tm"},{"type":"text","value":") anything. What shape do we expect the PC data to have? There are four of them with 50 time steps each, so (4, 50) or (50, 4).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gDVDFmijM0"}],"key":"jk2RZrRF3p"}],"key":"x0c32sNGQe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_2d.shape, eigvec.shape","key":"k5jHs1pfSx"},{"type":"output","id":"hymv2sC21aLRyHv1LnkmY","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"((200, 50), (200, 4))","content_type":"text/plain"}}}],"key":"wvVKFHtRCU"}],"key":"wkxq15tMOg"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We need to transpose the data:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PhjYpmJvv7"}],"key":"P0WYaeklM4"}],"key":"YB1mQJLSfJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pcs = np.real(np.dot(data_2d.T, eigvec))","key":"jdFAzsuxhk"},{"type":"output","id":"3mFblNQlXFT1SKquBUOG0","data":[],"key":"SCrNvmre8f"}],"key":"m7XErex5q4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The PCs have dimensions (time, mode):","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qR6UIynjlP"}],"key":"UjOYSPW8EH"}],"key":"ChpFUtyq0I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pcs.shape","key":"DxeGYqdXGx"},{"type":"output","id":"Yr83mfNnt9qc9-BlLgi85","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"(50, 4)","content_type":"text/plain"}}}],"key":"pgLCtjEvpq"}],"key":"PmlWAWMJQW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Lets look at the PCs:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xBfQs3XT8n"}],"key":"NkYadqeXso"}],"key":"q6Bd27MgiT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.plot(pcs[:, 0], label='PC1')\nplt.plot(pcs[:, 1], label='PC2')\nplt.plot(pcs[:, 2], label='PC3', linestyle=':')\nplt.plot(pcs[:, 3], label='PC4', linestyle=':')\nplt.legend(loc='upper left')\nplt.ylabel('PC')\nplt.xlabel('$t$')\nplt.xlim(0, nt-1)\nplt.title('First four PCs')","key":"QjuMLEQn5n"},{"type":"output","id":"qFjk1MPMi6tpmekw3twaU","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"fd22e0a5b9e131fbac2ebe8475fb4511","path":"/eofs-cookbook/build/fd22e0a5b9e131fbac2ebe8475fb4511.png"}}}],"key":"vzEbnz4ZTL"}],"key":"RxtvkHOUKN"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The EOFs are just the eigenvectors, but we need to reshape them back into the two spatial dimensions ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kfy1WUnX7w"},{"type":"inlineMath","value":"x,y","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">x,y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>","key":"eERdzOxQMA"},{"type":"text","value":":","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zpAKw5kXV0"}],"key":"QaZjpxI5JU"}],"key":"M9hG1kXMme"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"eofs = np.real(eigvec.reshape(10, 20, r))","key":"DGqsuhsNKQ"},{"type":"output","id":"KHfOJyVTu8cdxfL7J3TAZ","data":[],"key":"Ht1vSkLlLq"}],"key":"XFFzIAU8D7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s look at the leading EOF:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OMveHniswM"}],"key":"V6uLrOesyN"}],"key":"CzvvfzY90T"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 0], y[:, :, 0], eofs[:, :, 0], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('EOF1 (%.1f%%)' %pvar[0])","key":"YFuww0eBMz"},{"type":"output","id":"HC01BZI0fR95dCpUVQEfm","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"c84d83273b90d391c021320709004518","path":"/eofs-cookbook/build/c84d83273b90d391c021320709004518.png"}}}],"key":"gcMwjvNpzE"}],"key":"TclX8ylwHW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This looks like Mode 2 but with opposite sign and lower magnitude. We can attempt to reconstruct Mode 2 by multiplying this EOF with the corresponding PC:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MpxzNPeCvc"}],"key":"ZX7x8HdfEu"}],"key":"Zct2jrS7hm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1, 2, figsize=(10, 5))\n\nmode_2_reco_plot = ax[0].pcolormesh(x[:, :, 0], y[:, :, 0], eofs[:, :, 0]*pcs[2, 0], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(mode_2_reco_plot, ax=ax[0])\nax[0].set_ylabel('$y$')\nax[0].set_xlabel('$x$')\nax[0].set_title('Reconstructed Mode 2 at $t=0$')\n\nmode_2_orig_plot = plt.pcolormesh(x[:, :, 2], y[:, :, 2], mode_2[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(mode_2_orig_plot, ax=ax[1])\nax[1].set_ylabel('$y$')\nax[1].set_xlabel('$x$')\nax[1].set_title('Original Mode 2 at $t=0$')","key":"blDg02UwKs"},{"type":"output","id":"HyNscR8JBcLqac_YNzkH-","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x500 with 4 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"9ab676a9169cb8358b7fcda92d5a4238","path":"/eofs-cookbook/build/9ab676a9169cb8358b7fcda92d5a4238.png"}}}],"key":"YgovuQxnjq"}],"key":"rWXSYCrCDR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here is the next EOF:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VFTno78Twi"}],"key":"XUFaPke45u"}],"key":"X8gVM1NosC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 0], y[:, :, 0], eofs[:, :, 1], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('EOF2 (%.1f%%)' %pvar[1])","key":"d8qkHRYaa6"},{"type":"output","id":"sHJdosnh0ebNL-YXg9Vni","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"a578f432c4944a31ae25a6d64fdc88c2","path":"/eofs-cookbook/build/a578f432c4944a31ae25a6d64fdc88c2.png"}}}],"key":"tZjCyRad7J"}],"key":"X1oRsMmpUu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is Mode 1, plus some noise and some apparent contamination (","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jNrJKoMuxp"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"mode mixing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SAvtI0rq8A"}],"key":"gkLC7jmwwr"},{"type":"text","value":") from Mode 2. We could reconstruct this mode, as well, but instead, let’s take a look at the next two modes:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jrj757YFv2"}],"key":"j0Fjl0qqy6"}],"key":"eexZ5yIEao"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 0], y[:, :, 0], eofs[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('EOF3 (%.1f%%)' %pvar[2])","key":"NT4eqSQwvR"},{"type":"output","id":"peMtQ8Ifua9JQDKtx2AQU","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"701e388b6473dea924260a05a4d77015","path":"/eofs-cookbook/build/701e388b6473dea924260a05a4d77015.png"}}}],"key":"nTHrT9A2n3"}],"key":"rS0scRxI5a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 0], y[:, :, 0], eofs[:, :, 3], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('EOF4 (%.1f%%)' %pvar[3])","key":"JHfnOploCS"},{"type":"output","id":"GbWcBqvIESmRIY9KXrxwU","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d55154d24045bf96e304bd6f5f9ffd42","path":"/eofs-cookbook/build/d55154d24045bf96e304bd6f5f9ffd42.png"}}}],"key":"CUNf6oMxzM"}],"key":"Vl25A2pHOB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"EOF3 looks like some sort of residual from Mode 1, while EOF4 shows some zonal stripes that were not in our original data. Even though there is structure here, we should not interpret these as a meaningful or ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z7gOPzkZ3F"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"physical","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JAQs30nrHb"}],"key":"Z6uImpIPzQ"},{"type":"text","value":" modes of variability in the data; they are artifacts of the method, particularly the orthogonality constraints. The very low explained variance is also an indication that the modes are probably not meaningful.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vAtZyjZo4p"}],"key":"veGVdIbw0U"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"PC3 shows an oscillation with a period of about 10 time steps and EOF3 shows a pattern that we might expect from the data, so if we didn’t have ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"C0eLvDCpxX"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"a priori","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OLyXmJryo8"}],"key":"ibF8Kxm6fs"},{"type":"text","value":" knowledge about the data, we might have been tempted to interpret this mode as meaningful. We therefore have to be careful when interpreting the modes we find with EOF analyses.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NrB3mcW7Pz"}],"key":"DLpeZQmBj2"}],"key":"tDSOcQUkYW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exercise","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FKRVqpxQDT"}],"identifier":"exercise","label":"Exercise","html_id":"exercise","implicit":true,"key":"NmDrYBuCW7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Change the period of Mode 2 from 15 time steps to 20 time steps, bringing it closer in frequency to Mode 1. What happens?","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qXV34jv1Fb"}],"key":"Kj0v0czk5Z"}],"key":"SwLgEJTxLd"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Bonus 1: adding noise","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sq8MG3uI5p"}],"identifier":"bonus-1-adding-noise","label":"Bonus 1: adding noise","html_id":"bonus-1-adding-noise","implicit":true,"key":"AZhyA9NfIW"}],"key":"Ykuf3xVu3R"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Real geophysical data is rarely so clean. Let’s add some noise with a similar amplitude to the modes and see what happens. If the modes we constructed were modes of climate variability, this noise would be weather.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A7xbIGYveM"}],"key":"SvbmZxkhms"}],"key":"IBHrJq7QOT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"noisy_data = mode_1 + mode_2 + np.random.default_rng().normal(loc=0.0, scale=1.0, size=(nx, ny, nt))","key":"MnqWrjI3P5"},{"type":"output","id":"HRrxcxszxWnQChk-pN_DZ","data":[],"key":"tKzddi3co0"}],"key":"y8YAlbYLcF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s look at the data at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PEkTXgEZ0G"},{"type":"inlineMath","value":"t=0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">t=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"r7f5vMh41p"},{"type":"text","value":" for comparison:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O9vosWTuL5"}],"key":"JFRWsyDjfU"}],"key":"dN5sLxXn4d"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.pcolormesh(x[:, :, 2], y[:, :, 2], noisy_data[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar()\nplt.ylabel('$y$')\nplt.xlabel('$x$')\nplt.title('Noisy data at $t=0$')","key":"UP4bOaSg2F"},{"type":"output","id":"Q1_Y_EzqGqODguc4cFtLd","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"bc0215c2e89e201114f3d30b16815985","path":"/eofs-cookbook/build/bc0215c2e89e201114f3d30b16815985.png"}}}],"key":"r2Y9RPELfF"}],"key":"X1Ykes8dXd"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The modes aren’t nearly as apparent with the noise added, just like real climate data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Fs1ne4QHo1"}],"key":"x6USKA5h1U"}],"key":"pAB7vTCGnW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"noisy_data = (noisy_data.reshape(50, 10, 20) - noisy_data.mean(axis=2)).reshape(10, 20, 50)\nnoisy_data_2d = noisy_data.reshape(200, 50)\n\nn_R = np.cov(noisy_data_2d)\n(n_eigval, n_eigvec) = np.linalg.eig(n_R)\n\nn_i = np.argsort(-n_eigval)\nn_eigval = -np.sort(-n_eigval)\nn_eigvec = n_eigvec[:,i]\nr = 4\nn_eigval = n_eigval[:r]\nn_eigvec = n_eigvec[:, :r]\n\nn_pvar = np.real(n_eigval/np.trace(n_R)*100)\nn_pcs = np.real(np.dot(noisy_data_2d.T, n_eigvec))\nn_eofs = np.real(n_eigvec.reshape(10, 20, r))","key":"Fs4CECvyZz"},{"type":"output","id":"8HwEb8g9OX9QhNfLVCJek","data":[],"key":"gcU8UyarDF"}],"key":"x504GBAJPZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.plot(n_pcs[:, 0], label='PC1')\nplt.plot(n_pcs[:, 1], label='PC2')\nplt.plot(n_pcs[:, 2], label='PC3', linestyle=':')\nplt.plot(n_pcs[:, 3], label='PC4', linestyle=':')\nplt.legend(loc='upper left')\nplt.ylabel('PC')\nplt.xlabel('$t$')\nplt.xlim(0, nt-1)\nplt.title('First four PCs (noisy data)')","key":"l4ghsJG0QE"},{"type":"output","id":"xqOugzCxnoR_vY3LXcVNx","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"0be8b390287f61dac7ab6b79ad39f02e","path":"/eofs-cookbook/build/0be8b390287f61dac7ab6b79ad39f02e.png"}}}],"key":"Sg7MA5g2y4"}],"key":"iZl9qT9lLL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"n_fig, n_ax = plt.subplots(2, 2, figsize=(10, 5), layout='constrained')\n\nnoisy_eof1_plot = n_ax[0, 0].pcolormesh(x[:, :, 0], y[:, :, 0], n_eofs[:, :, 0], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(noisy_eof1_plot, ax=n_ax[0, 0])\nn_ax[0, 0].set_ylabel('$y$')\nn_ax[0, 0].set_title('Noisy EOF1 (%.1f%%)' %n_pvar[0])\n\nnoisy_eof2_plot = n_ax[0, 1].pcolormesh(x[:, :, 0], y[:, :, 0], n_eofs[:, :, 1], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(noisy_eof1_plot, ax=n_ax[0, 1])\nn_ax[0, 1].set_title('Noisy EOF2 (%.1f%%)' %n_pvar[1])\n\nnoisy_eof3_plot = n_ax[1, 0].pcolormesh(x[:, :, 0], y[:, :, 0], n_eofs[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(noisy_eof3_plot, ax=n_ax[1, 0])\nn_ax[1, 0].set_ylabel('$y$')\nn_ax[1, 0].set_xlabel('$x$')\nn_ax[1, 0].set_title('Noisy EOF3 (%.1f%%)' %n_pvar[2])\n\nnoisy_eof4_plot = n_ax[1, 1].pcolormesh(x[:, :, 0], y[:, :, 0], n_eofs[:, :, 3], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(noisy_eof4_plot, ax=n_ax[1, 1])\nn_ax[1, 1].set_xlabel('$x$')\nn_ax[1, 1].set_title('Noisy EOF4 (%.1f%%)' %n_pvar[3])","key":"qB2jULdiV4"},{"type":"output","id":"bCdkVlGEDLgNB4dDSO2Fm","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x500 with 8 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"e3331bb048b9f5f83397989e7cc67c33","path":"/eofs-cookbook/build/e3331bb048b9f5f83397989e7cc67c33.png"}}}],"key":"lyOaHEpDmM"}],"key":"iyQyrGpsya"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The EOF analysis has again successfully identified our two modes. The third and fourth modes explain more variance than in the clean example, but the spatial patterns strongly suggest that they are just noise.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZcAZ2y4XpQ"}],"key":"lnUHBSX11O"}],"key":"pvSEpjc23y"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Bonus 2: method of snapshots","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qg6PiTAcSk"}],"identifier":"bonus-2-method-of-snapshots","label":"Bonus 2: method of snapshots","html_id":"bonus-2-method-of-snapshots","implicit":true,"key":"YcdxEj37lW"}],"key":"FeGHGluaWm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sometimes you have a lot more locations than time steps in your data, making computing the covariance matrix impractical, if not impossible. For example, consider a few years of 0.1° gridded climate data formatted as 32-bit floats. That’s ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NPvUOTx7k8"},{"type":"inlineMath","value":"(3600\\times1800)^2\\times 4\\approx 1.68\\times10^{14}","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>3600</mn><mo>×</mo><mn>1800</mn><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>×</mo><mn>4</mn><mo>≈</mo><mn>1.68</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>14</mn></msup></mrow><annotation encoding=\"application/x-tex\">(3600\\times1800)^2\\times 4\\approx 1.68\\times10^{14}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">3600</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord\">1800</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1.68</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span></span></span></span>","key":"E36muBEQYI"},{"type":"text","value":" bytes, or about 168 TB, required to hold the covariance matrix in memory.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A7RKVaOWK4"}],"key":"JjLLp4impK"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"To get around this issue, we turn to the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HzJ6mkOw0J"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"method of snapshots","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nOeAiZOHq9"}],"key":"Ilv9bw8K5k"},{"type":"text","value":" ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SSxLKsd5eR"},{"type":"citeGroup","kind":"parenthetical","children":[{"type":"cite","kind":"parenthetical","label":"sirovich_turbulence_1987","identifier":"sirovich_turbulence_1987","children":[{"type":"text","value":"Sirovich, 1987","key":"K0gaANIF5h"}],"enumerator":"3","key":"KsrirWuCdb"}],"key":"c8Pzp5WyFE"},{"type":"text","value":". The only change in our simple example is that we compute the covariance of the transposed data, resulting in a matrix of dimension (time, time), which would be much more manageable in our 0.1° data example. Here is the result for our clean 2-mode data:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bwTeVP4HH1"}],"key":"pAutpYJH2a"}],"key":"lDTdX9ZJgu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s_R = np.cov(data_2d.T)\n(s_eigval, s_eigvec) = np.linalg.eig(s_R)\n\ns_i = np.argsort(-s_eigval)\ns_eigval = -np.sort(-s_eigval)\ns_eigvec = s_eigvec[:,s_i]\ns_eigval = s_eigval[:r]\ns_eigvec = s_eigvec[:, :r]\n\ns_pvar = np.real(s_eigval/np.trace(s_R)*100)\ns_pcs = np.real(s_eigvec)\ns_eofs = np.real(np.dot(data_2d, s_eigvec)).reshape(10, 20, r)","key":"CELB1FRn53"},{"type":"output","id":"BWdhAkdQ8xY4WlcRIdXww","data":[],"key":"SfVlgXuHxo"}],"key":"VsJTKBGlpJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"plt.plot(s_pcs[:, 0], label='PC1')\nplt.plot(s_pcs[:, 1], label='PC2')\nplt.plot(s_pcs[:, 2], label='PC3', linestyle=':')\nplt.plot(s_pcs[:, 3], label='PC4', linestyle=':')\nplt.legend(loc='upper left')\nplt.ylabel('PC')\nplt.xlabel('$t$')\nplt.xlim(0, nt-1)\nplt.title('First four PCs (method of snapshots)')","key":"liT6DGFU3m"},{"type":"output","id":"yPU2yL9S5KjI3D9jxYNuv","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"b352cf331c485d863a89eb0a9d3234fb","path":"/eofs-cookbook/build/b352cf331c485d863a89eb0a9d3234fb.png"}}}],"key":"T2Tyxjaz9z"}],"key":"HtRyM0wpdH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"s_fig, s_ax = plt.subplots(2, 2, figsize=(10, 5), layout='constrained')\n\nmos_eof1_plot = s_ax[0, 0].pcolormesh(x[:, :, 0], y[:, :, 0], s_eofs[:, :, 0], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(mos_eof1_plot, ax=s_ax[0, 0])\ns_ax[0, 0].set_ylabel('$y$')\ns_ax[0, 0].set_title('EOF1 (%.1f%%)' %s_pvar[0])\n\nmos_eof2_plot = s_ax[0, 1].pcolormesh(x[:, :, 0], y[:, :, 0], s_eofs[:, :, 1], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(mos_eof1_plot, ax=s_ax[0, 1])\ns_ax[0, 1].set_title('EOF2 (%.1f%%)' %s_pvar[1])\n\nmos_eof3_plot = s_ax[1, 0].pcolormesh(x[:, :, 0], y[:, :, 0], s_eofs[:, :, 2], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(mos_eof3_plot, ax=s_ax[1, 0])\ns_ax[1, 0].set_ylabel('$y$')\ns_ax[1, 0].set_xlabel('$x$')\ns_ax[1, 0].set_title('EOF3 (%.1f%%)' %s_pvar[2])\n\nmos_eof4_plot = s_ax[1, 1].pcolormesh(x[:, :, 0], y[:, :, 0], s_eofs[:, :, 3], cmap='RdBu_r', norm=CenteredNorm())\nplt.colorbar(mos_eof4_plot, ax=s_ax[1, 1])\ns_ax[1, 1].set_xlabel('$x$')\ns_ax[1, 1].set_title('EOF4 (%.1f%%)' %s_pvar[3])","key":"wiovIOdAeC"},{"type":"output","id":"cL8kDP9lIz7jj1vk6xoT9","data":[{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 1000x500 with 8 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d6f0de0f10c8cc71258ce9a1b016e8e6","path":"/eofs-cookbook/build/d6f0de0f10c8cc71258ce9a1b016e8e6.png"}}}],"key":"hL9sGrVtLx"}],"key":"kZlxCDGZdg"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CFXh0GGgQq"}],"key":"XG1YJ1k0s6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CFNsQaQJ78"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"IehGf2iYhl"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this notebook, we implemented the EOF method on some synthetic data using NumPy. First, we generated two simple modes of variability and combined them. Then, our EOF analysis was able to largely isolate the modes as the first two EOF/PC pairs.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iukJhKS1wy"}],"key":"GzgokGiV93"},{"type":"heading","depth":3,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"What’s next?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JihYWBuSre"}],"identifier":"whats-next","label":"What’s next?","html_id":"whats-next","implicit":true,"key":"D5DT9VUSsU"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In the next notebook, we will use a package called ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SOqv7ZEKMd"},{"type":"link","url":"https://xeofs.readthedocs.io/","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"xeofs","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gojC0qfWFi"}],"urlSource":"https://xeofs.readthedocs.io/","key":"ZObeIczBZ1"},{"type":"text","value":" to find climate modes in real sea surface temperature data.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Hi0J8YHU3p"}],"key":"arncMcNYKd"}],"key":"VRbQPH6u5v"}],"key":"tMWFyEl06O"},"references":{"cite":{"order":["chen_pairwise-rotated_2017","dommenget_cautionary_2002","sirovich_turbulence_1987"],"data":{"chen_pairwise-rotated_2017":{"label":"chen_pairwise-rotated_2017","enumerator":"1","doi":"10.1175/JCLI-D-16-0786.1","html":"Chen, X., Wallace, J. M., & Tung, K.-K. (2017). Pairwise-Rotated EOFs of Global SST. <i>Journal of Climate</i>, <i>30</i>(14), 5473–5489. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/JCLI-D-16-0786.1\">10.1175/JCLI-D-16-0786.1</a>","url":"https://doi.org/10.1175/JCLI-D-16-0786.1"},"dommenget_cautionary_2002":{"label":"dommenget_cautionary_2002","enumerator":"2","doi":"10.1175/1520-0442(2002)015<0216:ACNOTI>2.0.CO;2","html":"Dommenget, D., & Latif, M. (2002). A Cautionary Note on the Interpretation of EOFs. <i>Journal of Climate</i>, <i>15</i>(2), 216–225. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/1520-0442(2002)015&lt\">https://doi.org/10.1175/1520-0442(2002)015&lt</a>;0216:ACNOTI&gt;2.0.CO;2","url":"https://doi.org/10.1175/1520-0442(2002)015&lt"},"sirovich_turbulence_1987":{"label":"sirovich_turbulence_1987","enumerator":"3","doi":"10.1090/qam/910462","html":"Sirovich, L. (1987). Turbulence and the dynamics of coherent structures. I. Coherent structures. <i>Quarterly of Applied Mathematics</i>, <i>45</i>(3), 561–571. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1090/qam/910462\">10.1090/qam/910462</a>","url":"https://doi.org/10.1090/qam/910462"}}}},"footer":{"navigation":{"prev":{"title":"Introduction to EOFs","url":"/notebooks/eof-intro","group":"Foundations"},"next":{"title":"Finding Climate Modes with EOFs","url":"/notebooks/climate-modes-xeofs","group":"Foundations"}}},"domain":"http://localhost:3000"}